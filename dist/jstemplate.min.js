/*!
 * Simple JavaScript template engine
 * https://github.com/JoniJnm/jstemplate
 *
 * Copyright JoniJnm.es
 * Released under the GPL-2.0 license.
 *
 * Date: 2015-11-23
 */
!function(e,t){"use strict";"function"==typeof define&&define.amd?define([],t):"undefined"!=typeof module&&module.exports?module.exports=t():e.jstemplate=t()}(this,function(){"use strict";var e=function(e){this.html=e,this.code="",this.startBlocks=["if","for","while","foreach"],this.continueBlocks=["else","else if","elseif"],this.reservedWords=["break","continue","debugger","var","let"],this.startBlockRegex=new RegExp("^("+this.startBlocks.join("|")+") "),this.continueBlockRegex=new RegExp("^("+this.continueBlocks.join("|")+")( |$)"),this.rawCodeRegexs=[new RegExp("^("+this.reservedWords.join("|")+")( |$)"),/^[\w\.$]+\s*=[^=]/,/^[\w\.$]+\s*(\+\+|\-\-)$/],this.eachRegex=/^foreach ([\w\._]+) as ([\w_]+)$/};e.prototype={add:function(e){this.code+=e,this.code+="\n"},initCode:function(){this.add("with(self) {"),this.add('var __html = "";')},getCode:function(){return this.code},endCode:function(){this.add("}"),this.add("return __html;")},addRawHTML:function(e){e=this.trim(e),e&&this.add("__html += "+JSON.stringify(e)+";")},addForcedRawCode:function(e){this.addRawCode(e.substr(1))},addRawCode:function(e){this.add(e+";")},addForcedReturnedCode:function(e){this.addReturnedCode(e.substr(1))},addReturnedCode:function(e){this.add("__html += this.encode("+e+");")},addForcedReturnedRawCode:function(e){this.add("__html += "+e.substr(1)+";")},addEachBlock:function(e){var t=e.match(this.eachRegex),d=t[1],n=t[2];this.add("var _i = -1;"),this.add("for (var _key in "+d+") {"),this.add("if (!"+d+".hasOwnProperty(_key)) continue;"),this.add("_i++;"),this.add("var "+n+" = "+d+"[_key];")},addStartBlock:function(e){e=e.replace(/ /," ("),e+=") {",this.add(e)},addContinueBlock:function(e){this.addEndBlock(),"else"===e?this.add("else {"):(e=e.replace(/^else if/,"elseif"),e=e.replace(/ /," ("),e=e.replace(/^elseif/,"else if"),e+=") {",this.add(e))},addEndBlock:function(){this.add("}")},run:function(){this.initCode();var e=0,t=this.html,d=this;t=t.replace(/<script[^>]*>([\s\S]+?)<\/script>/g,function(e,t){return d.add(t),""}),t.replace(/\{([\s\S]+?)\}/g,function(n,i,o){i=i.replace(/^[ ]+/,"").replace(/ +$/,""),d.addRawHTML(t.substr(e,o-e)),d.isComment(i)||(d.isEachBlock(i)?d.addEachBlock(i):d.isStartBlock(i)?d.addStartBlock(i):d.isContinueBlock(i)?d.addContinueBlock(i):d.isEndBlock(i)?d.addEndBlock(i):d.isForcedRawCode(i)?d.addForcedRawCode(i):d.isForcedReturnCode(i)?d.addForcedReturnedCode(i):d.isForcedReturnRawCode(i)?d.addForcedReturnedRawCode(i):d.isRawCode(i)?d.addRawCode(i):d.addReturnedCode(i)),e=o+n.length}),this.endCode()},isEachBlock:function(e){return this.eachRegex.test(e)},isStartBlock:function(e){return this.startBlockRegex.test(e)},isContinueBlock:function(e){return this.continueBlockRegex.test(e)},isEndBlock:function(e){return"/"===e[0]},isForcedRawCode:function(e){return"#"===e[0]},isRawCode:function(e){for(var t=0;t<this.rawCodeRegexs.length;t++)if(this.rawCodeRegexs[t].test(e))return!0;return!1},isForcedReturnCode:function(e){return"="===e[0]},isForcedReturnRawCode:function(e){return"."===e[0]},isComment:function(e){return"*"===e[0]},trim:function(e){return e.replace(/^(\t|\n|\r)*/gm,"").replace(/(\t|\n|\r)*$/gm,"")}};var t=function(t){var d=new e(t);d.run();var i,o=d.getCode();try{i=new Function("self",o)}catch(r){throw r.code=o,r}return function(e){try{return i.call(n,e)}catch(t){throw t.code=o,t}}},d=function(e){return e&&e.toString?e.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;"):e},n={parse:t,encode:d};return n});